# Blockly库README编写规范

## 概述

本规范提供轻量化、自包含的Blockly库README标准格式。目标是让大模型无需外部规范即可理解库功能并生成正确的.abi文件，同时保持文档简洁（目标控制在5KB以内）。

## 核心设计原则

1. **自包含**: 包含所有必要信息，无需外部规范文档
2. **轻量化**: 信息密度高，避免冗余描述
3. **表格驱动**: 用表格压缩信息，提高可读性
4. **实用导向**: 重点突出.abi格式和连接规则

## 标准README结构

### 1. 标题与基本信息
```markdown
# [库名] 

[一句话功能描述]

## 库信息
- **库名**: package.json中的name
- **版本**: package.json中的version  
- **兼容**: package.json中的compatibility.core（简化描述）
```

### 2. 块定义核心表格（关键部分）
```markdown
## 块定义

| 块类型 | 连接 | 字段/输入 | .abi格式 | 生成代码 |
|--------|------|----------|----------|----------|
| `block_type` | 语句块/值块/Hat块 | 字段类型+输入类型 | 关键字段格式 | 核心代码片段 |
```

**表格填写规则**:
- **连接**: 语句块/值块/Hat块（3选1，简洁明了）
- **字段/输入**: 格式为`字段名(字段类型), 输入名(input)`
- **.abi格式**: 只列出关键字段的格式
- **生成代码**: 核心代码，不超过一行

### 3. 字段类型映射（必需参考表）
```markdown
## 字段类型映射

| 类型 | .abi格式 | 示例 |
|------|----------|------|
| field_input | 字符串 | `"FIELD": "value"` |
| field_dropdown | 字符串 | `"TYPE": "option"` |
| field_variable | 对象 | `"VAR": {"id": "var_id"}` |
| input_value | 块连接 | `"inputs": {"INPUT": {"block": {...}}}` |
| input_statement | 块连接 | `"inputs": {"DO": {"block": {...}}}` |
```

### 4. 连接规则（必需说明）
```markdown
## 连接规则

- **语句块**: 有previousStatement/nextStatement，通过`next`字段连接
- **值块**: 有output，连接到`inputs`中，无`next`字段
- **Hat块**: 无连接属性，通过`inputs`连接内部语句
- **特殊规则**: [库特有的连接规则，如变量ID格式等]
```

### 5. 使用示例（1-2个典型示例）
```markdown
## 使用示例

### [场景名称]
```json
{
  "type": "block_type",
  "id": "block_id",
  "fields": {"FIELD": "value"},
  "inputs": {"INPUT": {"block": {...}}}
}
```

### [复杂场景]（可选）
[完整的程序示例，展示块之间的连接]
```

### 6. 重要规则（必需）
```markdown
## 重要规则

1. **必须遵守**: [关键限制，如ID唯一性等]
2. **连接限制**: [连接相关的限制]
3. **常见错误**: [❌ 错误示例]

## 支持的[关键参数]
[如数据类型、板卡类型等关键选项]
```

## 信息压缩策略

### 删除的冗余内容
- ❌ 详细的generator.js代码实现
- ❌ 完整的block.json结构定义  
- ❌ 过度详细的字段说明
- ❌ 重复的概念解释
- ❌ 复杂的技术实现细节

### 保留的核心内容
- ✅ 完整的字段类型映射
- ✅ 清晰的连接规则
- ✅ 典型的.abi格式示例
- ✅ 关键的使用限制
- ✅ 库特有的重要规则

### 表格驱动设计
将复杂信息压缩到表格中：
- **块定义表**: 一行一个块，包含所有关键信息
- **字段映射表**: 标准化的字段类型参考
- **示例代码**: 直接可用的.abi片段

## 质量标准

### 内容完整性
- [ ] 包含toolbox.json中的所有块类型
- [ ] 覆盖所有字段类型和输入类型
- [ ] 提供典型的连接示例
- [ ] 说明库特有的规则

### 格式规范性
- [ ] 使用标准表格格式
- [ ] 代码块正确标记为json
- [ ] 信息层次清晰
- [ ] 无冗余描述

### 大模型友好性
- [ ] 自包含，无需外部文档
- [ ] 提供直接可用的.abi示例
- [ ] 明确说明连接规则
- [ ] 突出重要限制和错误避免

### 轻量化要求
- [ ] 总体积控制在5KB以内
- [ ] 信息密度高，无冗余内容
- [ ] 重点突出实用信息
- [ ] 避免过度详细的技术描述

## 特殊库类型处理

### Hat块库（如OneButton）
重点说明：
- 事件驱动的特性
- 回调函数的处理方式
- 自动添加到loop的机制

### 通信库（如MQTT）
重点说明：
- 板卡适配规则
- 回调参数的变量处理
- 连接状态的管理

### 核心库（如Variables）
重点说明：
- 变量ID的处理规则
- 作用域的判断逻辑
- 字段类型的区别

## 示例对比

### ❌ 冗余写法
```markdown
**🎯 块结构**
```json
{详细的block.json结构...}
```

**🏷️ 字段详解**
- `FIELD` (field_type): 详细描述...
  - 数据格式：...
  - .abi格式：...
  - 默认值：...

**💻 代码生成逻辑 (generator.js)**
```javascript
完整的generator代码...
```
```

### ✅ 简洁写法
```markdown
| `block_type` | 语句块 | FIELD(field_type), INPUT(input) | `"FIELD":"value"` | `code();` |
```

## 模板应用指南

1. **复制标准结构**: 使用固定的6个部分
2. **填写核心表格**: 重点完成块定义表格
3. **提供典型示例**: 1-2个.abi示例即可
4. **突出特殊规则**: 库特有的重要限制
5. **控制篇幅**: 总体积不超过5KB

## 维护原则

- **与代码同步**: README与block.json、toolbox.json保持一致
- **版本更新**: 新增块时及时更新表格
- **简洁原则**: 新增内容前考虑是否真正必要
- **实用导向**: 优先保证大模型能正确使用

---

此规范确保README文档既简洁又完整，让大模型能够快速理解库功能并生成正确的.abi文件。
可参考DHT库的README作为示例。