# 异步HTTP客户端 (AsyncHTTP)

非阻塞异步HTTP客户端库，支持Arduino UNO R4 WiFi和ESP32。

## 功能特性

- 支持 GET / POST / PUT / DELETE 请求
- 支持发送 JSON 和纯文本数据
- 回调式异步设计，不阻塞 `loop()`
- 最多 4 个并发请求
- 自动解析响应状态码、响应头和响应体
- 超时控制和全局错误回调
- ESP32 支持 HTTPS

## 兼容板卡

| 板卡 | 支持 |
|------|------|
| ESP32 系列 | ✅ HTTP + HTTPS |
| Arduino UNO R4 WiFi | ✅ 仅 HTTP |

## 使用说明

### 基本流程

1. 在 `setup` 中使用 **创建异步HTTP客户端** 块进行初始化
2. 设置超时时间和默认请求头（可选）
3. 使用 **发送GET/POST/PUT/DELETE请求** 块发送请求
4. 在请求回调中使用 **响应数据** 块获取响应信息
5. 使用 **错误回调** 块处理错误（可选）
6. `update()` 已自动添加到 `loop()` 中，无需手动处理

### 块说明

#### 初始化

| 块 | 说明 |
|----|------|
| 创建异步HTTP客户端 | 创建对象并初始化，自动在loop中调用update() |
| 设置超时时间 | 设置请求超时（默认10秒） |
| 设置默认请求头 | 添加一个应用到所有请求的请求头 |
| 清除所有默认请求头 | 移除已设置的所有默认请求头 |

#### 发送请求

所有请求块都包含 **收到响应后** 回调区域，可在其中使用响应数据块。

| 块 | 说明 |
|----|------|
| 发送GET请求 | 获取指定URL的数据 |
| 发送POST JSON请求 | 发送JSON数据到指定URL |
| 发送POST请求 | 发送自定义类型内容到指定URL |
| 发送PUT JSON请求 | 发送JSON数据更新指定URL资源 |
| 发送DELETE请求 | 删除指定URL的资源 |

#### 响应数据（在请求回调中使用）

| 块 | 返回类型 | 说明 |
|----|---------|------|
| HTTP响应状态码 | 数字 | 如 200、404 等 |
| HTTP响应内容 | 文本 | 响应正文 |
| HTTP响应是否成功 | 布尔 | 状态码 200-299 为成功 |
| HTTP响应头的值 | 文本 | 获取指定响应头的值 |

#### 错误处理

| 块 | 说明 |
|----|------|
| 当发生错误时 | Hat块，设置全局错误回调 |
| HTTP错误代码 | 在错误回调中获取错误代码 |
| HTTP错误信息 | 在错误回调中获取错误文本 |

#### 管理

| 块 | 说明 |
|----|------|
| 待处理请求数 | 获取正在进行中的请求数量 |
| 取消所有请求 | 取消所有正在进行的请求 |

## 注意事项

1. **需要WiFi连接**: 使用前必须确保WiFi已连接
2. **非阻塞**: 请求发送后立即返回，响应通过回调处理
3. **回调作用域**: 响应数据块（状态码、内容等）仅在请求回调中有效
4. **错误作用域**: 错误代码和错误信息块仅在错误回调中有效
5. **并发限制**: 默认最多 4 个并发请求
