# AccelStepper库 - Blockly封装

## 概述

AccelStepper是一个功能强大的Arduino步进电机控制库，支持加速度和减速度控制。这个Blockly封装库将AccelStepper的主要功能转换为可视化编程块，让用户可以通过拖拽的方式轻松控制步进电机。

## 主要特性

- **多种步进电机接口**：支持2线、3线、4线步进电机以及步进电机驱动器
- **加速度控制**：支持设置最大速度、加速度和恒定速度运行
- **位置控制**：支持绝对位置和相对位置移动
- **状态查询**：可查询当前位置、目标位置、运行状态等
- **非阻塞运行**：支持非阻塞式运行，不影响其他程序执行

## 支持的步进电机类型

### 接口类型
1. **4线全步进** (FULL4WIRE) - 最常见的4线步进电机
2. **2线步进驱动器** (DRIVER) - 使用步进电机驱动器，只需要步进和方向信号
3. **2线全步进** (FULL2WIRE) - 双极性2线步进电机
4. **3线全步进** (FULL3WIRE) - 如硬盘主轴电机等3线步进电机
5. **4线半步进** (HALF4WIRE) - 4线半步进模式，提供更精确的控制
6. **3线半步进** (HALF3WIRE) - 3线半步进模式

## 功能块说明

### 初始化和配置
- **初始化步进电机**：设置步进电机类型和引脚连接
- **设置最大速度**：设置步进电机的最大运行速度（步/秒）
- **设置加速度**：设置加速和减速度（步/秒²）
- **设置速度**：设置恒定速度运行的速度值

### 运动控制
- **移动到绝对位置**：设置目标绝对位置
- **相对移动**：相对于当前位置移动指定步数
- **运行电机（带加速度）**：以设定的加速度运行到目标位置
- **运行电机（恒定速度）**：以恒定速度运行
- **运行到目标位置**：阻塞式运行到目标位置
- **运行到新位置**：设置新目标位置并阻塞式运行

### 控制和查询
- **停止电机**：立即停止电机运行
- **设置当前位置**：重新设定当前位置基准点
- **获取当前位置**：读取电机当前位置
- **获取目标位置**：读取设定的目标位置
- **获取剩余步数**：距离目标位置还需要的步数
- **检查运行状态**：判断电机是否正在运行
- **获取当前速度**：读取电机当前运行速度

## 使用示例

### 基本使用步骤
1. 初始化步进电机，选择合适的接口类型和引脚
2. 设置最大速度和加速度参数
3. 设置目标位置或移动步数
4. 在主循环中调用运行函数

### 简单往复运动示例
```
初始化步进电机 stepper1 类型4线全步进 引脚1:2 引脚2:3 引脚3:4 引脚4:5
设置步进电机 stepper1 最大速度 1000 步/秒
设置步进电机 stepper1 加速度 500 步/秒²
步进电机 stepper1 移动到绝对位置 1000 步

循环执行：
  运行步进电机 stepper1 (带加速度)
  如果 步进电机 stepper1 距离目标位置的步数 = 0：
    步进电机 stepper1 移动到绝对位置 (0 - 步进电机 stepper1 当前位置) 步
```

### 恒定速度运行示例
```
初始化步进电机 stepper1 类型2线步进驱动器 引脚1:2 引脚2:3
设置步进电机 stepper1 最大速度 500 步/秒
设置步进电机 stepper1 速度 100 步/秒

循环执行：
  运行步进电机 stepper1 (恒定速度)
```

## 硬件连接

### 4线步进电机连接
- 引脚1：连接到步进电机线圈A+
- 引脚2：连接到步进电机线圈A-
- 引脚3：连接到步进电机线圈B+
- 引脚4：连接到步进电机线圈B-

### 步进电机驱动器连接
- 引脚1：连接到驱动器的STEP引脚
- 引脚2：连接到驱动器的DIR引脚
- 驱动器的电源和步进电机按驱动器说明书连接

## 注意事项

1. **速度限制**：步进电机的最大可靠速度约为4000步/秒（16MHz Arduino）
2. **电源要求**：步进电机通常需要外部电源，Arduino的5V输出可能不足
3. **非阻塞运行**：推荐在主循环中使用`run()`或`runSpeed()`而不是阻塞式函数
4. **位置精度**：这是开环控制，如果电机失步，位置计算会出现偏差
5. **加速度设置**：调用`setAcceleration()`是耗时操作，不要频繁调用

## 技术支持

本库基于开源的AccelStepper库（v1.65）开发，详细技术文档请参考：
- [AccelStepper官方文档](http://www.airspayce.com/mikem/arduino/AccelStepper/)
- [AccelStepper GitHub仓库](https://github.com/waspinator/AccelStepper)

## 开源说明

本Blockly封装基于AccelStepper开源库，AccelStepper库遵循GPL V3许可证。
