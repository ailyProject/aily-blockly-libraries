# ESP32 WiFi库

## 简介
ESP32 WiFi库为aily blockly提供了完整的WiFi功能支持，包括：
- WiFi网络连接和断开
- WiFi热点模式
- 网络扫描
- HTTP客户端功能
- WiFi事件处理
- **NTP时钟同步功能** ⭐ 新增

## 功能特性

### WiFi连接管理
- **连接WiFi网络**：支持连接到指定的WiFi网络
- **检查连接状态**：实时检查WiFi连接状态
- **断开连接**：主动断开WiFi连接
- **获取网络信息**：获取本地IP地址和信号强度

### 网络扫描
- **扫描网络**：扫描周围可用的WiFi网络
- **获取扫描结果**：获取扫描到的网络名称

### 热点模式
- **创建热点**：将ESP32设置为WiFi热点
- **获取热点IP**：获取热点模式下的IP地址

### 网络客户端
- **连接服务器**：连接到指定的服务器和端口
- **发送数据**：向服务器发送数据
- **接收数据**：从服务器接收数据
- **关闭连接**：关闭网络连接

### HTTP功能
- **HTTP GET请求**：发送HTTP GET请求并获取响应

### 事件处理
- **WiFi事件**：处理WiFi连接、断开等事件

### NTP时钟同步 ⭐ 新增
- **NTP时间同步**：自动从网络时间服务器同步时间
- **多种时间格式**：支持完整时间、年月日时分秒、星期、时间戳等9种格式
- **时区管理**：支持全球主要时区和自定义时区设置
- **同步状态检查**：实时检查时间同步状态
- **自定义格式**：支持strftime格式字符串自定义时间显示

## 使用示例

### 基本WiFi连接
```
连接WiFi网络 "your-ssid" 密码 "your-password"
等待直到 WiFi已连接
串口输出 "WiFi连接成功"
串口输出 获取本地IP地址
```

### HTTP请求
```
连接WiFi网络 "your-ssid" 密码 "your-password"
等待直到 WiFi已连接
设置变量 response 为 HTTP GET请求 "http://httpbin.org/get"
串口输出 response
```

### NTP时钟同步 ⭐ 新增
```
连接WiFi网络 "your-ssid" 密码 "your-password"
等待直到 WiFi已连接
初始化NTP时钟 服务器 "pool.ntp.org" 时区偏移 8 小时
等待直到 NTP时间已同步
串口输出 "当前时间: " + 获取当前时间 格式 完整时间
串口输出 "今天是: " + 获取当前时间 格式 星期
```

## NTP时钟功能详细说明

### 🕐 时间同步积木块

#### 基础NTP初始化
```
初始化NTP时钟 服务器 [NTP服务器] 时区偏移 [小时数] 小时
```
- **功能**: 初始化NTP时间同步
- **参数**:
  - NTP服务器: 如 "pool.ntp.org", "ntp.aliyun.com"
  - 时区偏移: 相对UTC的小时数，北京时间为8

#### 高级NTP初始化
```
初始化NTP时钟 服务器 [NTP服务器] 时区偏移 [小时数] 小时 夏令时偏移 [小时数] 小时
```
- **功能**: 支持夏令时的NTP初始化
- **参数**: 额外支持夏令时偏移设置

### 🕑 时间获取积木块

#### 标准时间获取
```
获取当前时间 格式 [格式选择]
```
- **返回**: String类型的时间信息
- **格式选项**:
  - 完整时间: "2024-01-15 14:30:25"
  - 年份: "2024" | 月份: "1" | 日期: "15"
  - 小时: "14" | 分钟: "30" | 秒钟: "25"
  - 星期: "星期一" | 时间戳: "1705298425"

#### 自定义格式时间
```
获取格式化时间 格式 [格式字符串]
```
- **功能**: 使用strftime格式字符串自定义时间格式
- **示例**: "%Y年%m月%d日" → "2024年01月15日"

#### Unix时间戳
```
获取Unix时间戳
```
- **返回**: Number类型的Unix时间戳

### 🕒 状态检查积木块
```
NTP时间已同步
```
- **返回**: Boolean类型，检查时间是否已成功同步

### 🌍 时区设置积木块
```
设置时区 [时区选择]
```
- **选项**: 北京时间(UTC+8)、东京时间(UTC+9)、纽约时间(UTC-5)等

```
设置自定义时区 [时区字符串]
```
- **功能**: 使用POSIX时区字符串设置时区

### 常用NTP服务器
- **国际通用**: pool.ntp.org
- **阿里云**: ntp.aliyun.com
- **腾讯云**: ntp.tencent.com
- **中国**: cn.pool.ntp.org

## 兼容性
- **支持开发板**：ESP32、ESP32-C3、ESP32-S3
- **工作电压**：3.3V
- **依赖库**：WiFi.h、time.h（ESP32核心库自带）

## 注意事项

### 一般注意事项
1. 确保ESP32已连接到WiFi网络再使用HTTP客户端功能
2. 使用热点模式时会断开原有的WiFi连接
3. 网络扫描功能可能需要几秒钟时间完成

### NTP功能注意事项
4. **WiFi连接**: 使用NTP功能前必须先连接WiFi
5. **同步时间**: 首次同步可能需要几秒钟时间
6. **网络依赖**: NTP同步需要网络连接，离线时无法更新时间
7. **精度**: ESP32内部时钟精度有限，建议定期重新同步
8. **时区**: 设置时区后会影响所有时间获取函数的结果

## 参考文档
- [ESP32 Arduino WiFi库文档](https://docs.espressif.com/projects/arduino-esp32/en/latest/libraries.html)
- [ESP32 时间函数文档](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/system_time.html)
- [NTP协议说明](https://en.wikipedia.org/wiki/Network_Time_Protocol)