# NimBLE 蓝牙库

基于 NimBLE-Arduino 的低功耗蓝牙 (BLE) Blockly 图形化编程库，支持 ESP32 系列开发板。

## 库信息
- **库名**: @aily-project/lib-nimble
- **版本**: 1.0.0
- **兼容**: ESP32 系列 (ESP32, ESP32-C3, ESP32-S3, ESP32-C6 等)

## 功能概述

本库支持以下 BLE 功能：

### 🖥️ 服务端模式
- 创建 BLE 服务端
- 添加服务和特征值
- 广播设备，等待客户端连接
- 发送通知给已连接客户端

### 📱 客户端模式
- 扫描周围 BLE 设备
- 连接到目标设备
- 读写远程特征值
- 订阅通知

## 快速开始

### 创建 BLE 服务端

1. **初始化 NimBLE** - 设置设备名称
2. **创建服务端** - 获取服务端实例
3. **创建服务** - 添加 UUID 标识的服务
4. **创建特征** - 在服务中添加可读写的特征值
5. **启动服务** - 启动所有已创建的服务
6. **开始广播** - 让设备可以被发现

### 创建 BLE 客户端

1. **初始化 NimBLE** - 设置设备名称（可为空）
2. **配置扫描回调** - 设置发现设备时的处理
3. **开始扫描** - 搜索周围 BLE 设备
4. **创建客户端** - 获取客户端实例
5. **连接设备** - 连接到目标服务端
6. **读写数据** - 操作远程特征值

## 块分类说明

| 分类 | 颜色 | 功能 |
|------|------|------|
| 初始化 | 蓝色 | 设备初始化、地址获取、MTU设置 |
| 服务端 | 绿色 | 创建服务端、服务、特征值 |
| 广播 | 紫色 | 配置和控制广播 |
| 扫描 | 青色 | 扫描BLE设备 |
| 客户端 | 棕色 | 连接和操作远程设备 |
| 事件 | 粉色 | 连接、断开、数据写入等回调 |

## 特征属性说明

创建特征时可选择以下属性组合：

| 属性 | 说明 |
|------|------|
| 读+写 | 客户端可读取和写入 |
| 只读 | 客户端只能读取 |
| 只写 | 客户端只能写入 |
| 读+通知 | 可读取，服务端可主动通知 |
| 读+写+通知 | 完整读写和通知功能 |
| 读+写+指示 | 读写和带确认的指示功能 |

## UUID 说明

- **16位 UUID**: 如 `"ABCD"`, `"1234"` - 简短易记
- **128位 UUID**: 如 `"12345678-1234-5678-1234-56789abcdef0"` - 标准格式

## 常见问题

### Q: 如何在回调中获取数据？
在"当特征被写入时"回调中，可以使用"获取特征值"块读取写入的数据。

### Q: 扫描回调中如何获取设备信息？
使用以下块获取扫描到的设备信息：
- `扫描到的设备名称`
- `扫描到的设备地址`
- `扫描到的设备信号强度`
- `扫描到的设备包含服务`

### Q: 如何接收远程设备的通知？
使用"订阅远程特征通知"块，在回调中使用"收到的通知数据"块获取数据。

## 示例场景

### 蓝牙遥控器
服务端创建控制服务，客户端写入控制命令。

### 传感器数据广播
服务端定时更新特征值并发送通知，客户端订阅接收。

### 设备配网
通过BLE接收WiFi配置信息，完成设备联网。

## 注意事项

1. NimBLE 仅支持 ESP32 系列芯片
2. 初始化前确保蓝牙硬件可用
3. 服务端和客户端模式可同时运行
4. 建议使用唯一的 UUID 避免冲突

## 更多资源

- [NimBLE-Arduino 官方文档](https://github.com/h2zero/NimBLE-Arduino)
- [BLE 协议基础知识](https://www.bluetooth.com/specifications/specs/)
