<!DOCTYPE html>
<html>
<head>
    <title>简单测试</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
</head>
<body>
    <h1>简单测试 - 检查是否还有错误</h1>
    <div id="result"></div>
    
    <script>
        const resultDiv = document.getElementById('result');
        
        // 监听所有错误
        window.addEventListener('error', function(e) {
            resultDiv.innerHTML += `<p style="color: red;">❌ 错误: ${e.message}</p>`;
            console.error('捕获到错误:', e);
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            resultDiv.innerHTML += `<p style="color: red;">❌ Promise错误: ${e.reason}</p>`;
            console.error('捕获到Promise错误:', e);
        });
        
        // 加载generator.js
        const script = document.createElement('script');
        script.src = './generator.js';
        script.onload = function() {
            resultDiv.innerHTML += '<p style="color: green;">✅ generator.js 加载成功</p>';
            
            // 测试扩展注册
            try {
                if (typeof Blockly !== 'undefined' && Blockly.Extensions) {
                    resultDiv.innerHTML += '<p style="color: green;">✅ Blockly.Extensions 可用</p>';
                    
                    // 检查扩展是否已注册
                    if (Blockly.Extensions.isRegistered && Blockly.Extensions.isRegistered('tft_image_file_extension_simple')) {
                        resultDiv.innerHTML += '<p style="color: green;">✅ 扩展已注册</p>';
                    } else {
                        resultDiv.innerHTML += '<p style="color: orange;">⚠️ 扩展可能未注册或检查方法不可用</p>';
                    }
                } else {
                    resultDiv.innerHTML += '<p style="color: red;">❌ Blockly.Extensions 不可用</p>';
                }
            } catch (error) {
                resultDiv.innerHTML += `<p style="color: red;">❌ 测试扩展时出错: ${error.message}</p>`;
            }
            
            resultDiv.innerHTML += '<p style="color: blue;">ℹ️ 如果没有看到错误消息，说明修复成功！</p>';
        };
        
        script.onerror = function() {
            resultDiv.innerHTML += '<p style="color: red;">❌ 无法加载 generator.js</p>';
        };
        
        document.head.appendChild(script);
    </script>
</body>
</html>
