# Seeed SSCMA AI视觉传感器 Blockly库

## 简介

Seeed SSCMA (Seeed SenseCraft Model Assistant) 是一个强大的AI视觉传感器库,支持目标检测、图像分类、关键点检测等多种AI功能。本Blockly库将其封装为易用的图形化编程块,让用户可以轻松使用AI视觉功能。

## 主要特性

- **多种AI功能**: 支持目标检测(Boxes)、图像分类(Classes)、点检测(Points)、关键点检测(Keypoints)
- **多种通信方式**: 支持UART、I2C、SPI三种通信协议
- **性能监控**: 可获取预处理、推理、后处理各阶段的耗时
- **图像获取**: 支持获取推理过程中的图像数据(Base64编码)
- **设备信息**: 可查询设备ID、名称、模型信息等

## 支持的板卡

- ESP32系列
- Arduino SAMD系列
- Arduino Mbed系列  
- Renesas UNO R4 WiFi

## 依赖库

- Seeed Arduino SSCMA (>= 1.0.0)
- ArduinoJson (>= 6.0.0)

## 块分类

### 初始化块

#### 1. 初始化SSCMA (UART)
- **描述**: 使用UART方式初始化SSCMA传感器(默认方式)
- **参数**:
  - 变量名: AI对象的变量名
- **示例**: 创建名为"ai"的SSCMA对象

#### 2. 初始化SSCMA (I2C)
- **描述**: 使用I2C方式初始化SSCMA传感器
- **参数**:
  - 变量名: AI对象的变量名
  - 使用I2C: I2C对象引用
  - RST引脚: 复位引脚(-1表示不使用)
  - I2C地址: 设备地址(默认0x62即98)

#### 3. 初始化SSCMA (SPI)
- **描述**: 使用SPI方式初始化SSCMA传感器
- **参数**:
  - 变量名: AI对象的变量名
  - 使用SPI: SPI对象引用
  - CS引脚: 片选引脚
  - SYNC引脚: 同步引脚
  - RST引脚: 复位引脚

### AI推理块

#### 4. 执行AI推理
- **描述**: 执行AI推理并获取结果
- **参数**:
  - AI对象: 选择已创建的SSCMA对象
  - 次数: 推理执行次数(默认1)
  - 是否显示图像: 是否获取推理图像

#### 5. 执行推理成功?
- **描述**: 检查AI推理是否成功执行
- **返回**: Boolean值(成功返回true)

### 目标检测(Boxes)块

#### 6. 检测到的目标数量
- **描述**: 获取检测到的边界框数量
- **返回**: 数值

#### 7. 第N个目标的属性
- **描述**: 获取指定目标的属性值
- **参数**:
  - 索引: 目标索引(从0开始)
  - 属性: X坐标/Y坐标/宽度/高度/置信度/类别ID
- **返回**: 数值

### 分类(Classes)块

#### 8. 分类结果数量
- **描述**: 获取分类结果的数量
- **返回**: 数值

#### 9. 第N个分类的属性
- **描述**: 获取指定分类的属性值
- **参数**:
  - 索引: 分类索引(从0开始)
  - 属性: 类别ID/置信度
- **返回**: 数值

### 点检测(Points)块

#### 10. 检测到的点数量
- **描述**: 获取检测到的点数量
- **返回**: 数值

#### 11. 第N个点的属性
- **描述**: 获取指定点的属性值
- **参数**:
  - 索引: 点索引(从0开始)
  - 属性: X坐标/Y坐标/Z坐标/置信度/类别ID
- **返回**: 数值

### 关键点检测(Keypoints)块

#### 12. 检测到的关键点组数量
- **描述**: 获取检测到的关键点组数量
- **返回**: 数值

#### 13. 第N个关键点组的边界框属性
- **描述**: 获取关键点组边界框的属性值
- **参数**:
  - 索引: 关键点组索引(从0开始)
  - 属性: X坐标/Y坐标/宽度/高度/置信度/类别ID
- **返回**: 数值

#### 14. 第N个关键点组的点数量
- **描述**: 获取指定关键点组包含的点数量
- **参数**:
  - 索引: 关键点组索引
- **返回**: 数值

#### 15. 关键点组中指定点的属性
- **描述**: 获取关键点组中指定点的属性值
- **参数**:
  - 关键点组索引: 从0开始
  - 点索引: 从0开始
  - 属性: X坐标/Y坐标/置信度/类别ID
- **返回**: 数值

### 性能与信息块

#### 16. 推理性能
- **描述**: 获取AI推理各阶段的耗时
- **参数**:
  - 阶段: 预处理/推理/后处理
- **返回**: 耗时(毫秒)

#### 17. 获取设备ID
- **描述**: 获取SSCMA设备的唯一ID
- **返回**: 字符串

#### 18. 获取设备名称
- **描述**: 获取SSCMA设备的名称
- **返回**: 字符串

#### 19. 获取模型信息
- **描述**: 获取当前加载模型的信息
- **返回**: Base64编码的模型信息字符串

#### 20. 获取最后图像
- **描述**: 获取最后推理的图像数据
- **返回**: Base64编码的图像字符串

## 使用示例

### 示例1: 简单目标检测

```
初始化SSCMA
  变量名: ai

重复执行
  如果 ai 执行推理成功?
    如果 ai 检测到的目标数量 > 0
      串口打印 "X坐标: " ai 第0个目标的X坐标
      串口打印 "Y坐标: " ai 第0个目标的Y坐标
```

### 示例2: 风扇追踪(基于fan_tracking.ino)

```
初始化SSCMA
  变量名: ai

设置引脚模式 D0 为 输出

重复执行
  如果 ai 执行推理成功?
    如果 ai 检测到的目标数量 > 0
      设置 x 为 ai 第0个目标的X坐标
      如果 x < 80
        // 向左旋转舵机
        数字输出 D0 高电平
        延时微秒 2500
        数字输出 D0 低电平
      否则 如果 x > 140
        // 向右旋转舵机
        数字输出 D0 高电平
        延时微秒 500
        数字输出 D0 低电平
```

### 示例3: 性能监控

```
初始化SSCMA
  变量名: ai

重复执行
  ai 执行AI推理
  串口打印 "预处理: " ai 推理性能 预处理耗时(ms) "ms"
  串口打印 "推理: " ai 推理性能 推理耗时(ms) "ms"
  串口打印 "后处理: " ai 推理性能 后处理耗时(ms) "ms"
```

## 技术说明

### 通信协议选择

1. **UART(默认)**: 最简单,适合快速上手
2. **I2C**: 节省引脚,适合引脚资源有限的场景
3. **SPI**: 传输速度最快,适合需要高帧率的应用

### 数据结构

- **Boxes**: 目标检测边界框,包含位置(x,y)、尺寸(w,h)、置信度、类别
- **Classes**: 分类结果,包含类别ID和置信度
- **Points**: 检测点,包含3D坐标(x,y,z)、置信度、类别
- **Keypoints**: 关键点组,包含边界框和多个关键点

### 性能优化

- 推理次数默认为1,可根据需要调整
- 不需要图像时关闭图像获取功能以提高性能
- 使用SPI通信可获得最佳传输性能

## 注意事项

1. **内存限制**: AVR平台(如Arduino UNO)内存不足,不支持此库
2. **串口波特率**: UART模式默认921600,请确保板卡支持
3. **I2C地址**: 默认0x62(98),如有冲突可修改
4. **图像数据**: 获取图像需要较大内存(16KB+),请谨慎使用

## 参考资源

- [Seeed SSCMA官方文档](https://github.com/Seeed-Studio/Seeed_Arduino_SSCMA)
- [SSCMA固件](https://github.com/Seeed-Studio/SSCMA-Micro)
- [示例程序](./src/examples/)

## 许可证

MIT License

## 版本历史

- v1.0.0 (2025-10-27): 初始版本
  - 支持UART/I2C/SPI三种通信方式
  - 完整的目标检测、分类、关键点检测功能
  - 性能监控和设备信息查询
